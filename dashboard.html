<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Artesanal Blend</title>
<style>
:root {
  --bg: #f9f9f9;
  --panel: #ffffff;
  --accent: #3b82f6;
  --accent-hover: #2563eb;
  --muted: #666;
  --text: #222;
  --border: #ddd;
  --success: #22c55e;
  --danger: #ef4444;
  --warning: #f59e0b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}

.wrap {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #fff;
  border-radius: 12px;
  padding: 16px 24px;
  margin-bottom: 24px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border: 1px solid var(--border);
}

.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

header img {
  width: 60px;
  height: 60px;
  border-radius: 10px;
  object-fit: cover;
}

header h1 {
  font-size: 24px;
  font-weight: 700;
  color: var(--text);
}

.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.user-info {
  font-size: 14px;
  color: var(--muted);
}

/* Main Grid */
.grid {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: 24px;
}

@media (max-width: 1200px) {
  .grid {
    grid-template-columns: 1fr;
  }
}

/* Panels */
.panel {
  background: var(--panel);
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  border: 1px solid var(--border);
  margin-bottom: 20px;
}

.panel h2 {
  margin: 0 0 20px 0;
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.stat-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
}

.stat-card .num {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

.stat-card .label {
  font-size: 14px;
  opacity: 0.9;
}

/* Tables */
.table-container {
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid var(--border);
}

table {
  width: 100%;
  border-collapse: collapse;
  background: var(--panel);
}

th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

th {
  background: #f8fafc;
  font-weight: 600;
  color: var(--text);
}

tr:hover {
  background: #f8fafc;
}

/* Forms */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  color: var(--text);
  font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 14px;
  transition: border-color 0.2s;
  background: var(--panel);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Image Preview */
.img-preview {
  width: 100%;
  height: 200px;
  background: #f8fafc;
  border: 2px dashed var(--border);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-bottom: 16px;
}

.img-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.img-preview .placeholder {
  color: var(--muted);
  text-align: center;
  padding: 20px;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
}

.btn-primary {
  background: var(--accent);
  color: white;
}

.btn-primary:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-ghost {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.btn-ghost:hover {
  background: #f8fafc;
}

.btn-sm {
  padding: 8px 12px;
  font-size: 12px;
}

/* Form Actions */
.form-actions {
  display: flex;
  gap: 12px;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
}

/* Tools */
.tools {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
}

/* Orders List */
.orders-list {
  max-height: 500px;
  overflow-y: auto;
}

.order-item {
  background: #f8fafc;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  border-left: 4px solid var(--accent);
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.order-id {
  font-weight: 600;
  color: var(--text);
}

.order-date {
  color: var(--muted);
  font-size: 12px;
}

.order-total {
  font-weight: 600;
  color: var(--success);
}

/* Login Modal */
.login-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.login-box {
  background: white;
  padding: 32px;
  border-radius: 12px;
  width: 400px;
  max-width: 90vw;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}

.login-box h3 {
  margin-bottom: 24px;
  text-align: center;
  color: var(--text);
}

/* Tabs */
.tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  background: #f8fafc;
  padding: 4px;
  border-radius: 8px;
}

.tab {
  flex: 1;
  padding: 12px 16px;
  text-align: center;
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
}

.tab.active {
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Status badges */
.status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.status-completed {
  background: #d1fae5;
  color: #065f46;
}

.status-cancelled {
  background: #fee2e2;
  color: #991b1b;
}

/* Action buttons in tables */
.action-buttons {
  display: flex;
  gap: 8px;
}

/* Responsive */
@media (max-width: 768px) {
  .wrap {
    padding: 12px;
  }
  
  header {
    flex-direction: column;
    gap: 12px;
    text-align: center;
  }
  
  .header-left, .header-right {
    justify-content: center;
  }
  
  .panel {
    padding: 16px;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
}

/* Loading states */
.loading {
  opacity: 0.6;
  pointer-events: none;
}

/* Notifications */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 16px 20px;
  border-radius: 8px;
  background: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border-left: 4px solid var(--success);
  z-index: 1001;
  transform: translateX(400px);
  transition: transform 0.3s;
}

.notification.show {
  transform: translateX(0);
}

.notification.error {
  border-left-color: var(--danger);
}

/* Chart container */
.chart-container {
  background: white;
  padding: 16px;
  border-radius: 8px;
  border: 1px solid var(--border);
  margin-top: 16px;
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="header-left">
      <img src="logo.jpg" alt="Artesanal Blend">
      <h1>Dashboard Artesanal Blend</h1>
    </div>
    <div class="header-right">
      <div class="user-info">
        Usu√°rio: <strong id="currentUser">‚Äî</strong>
      </div>
      <button id="logoutBtn" class="btn btn-ghost" style="display:none">Sair</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
    <button class="tab" onclick="showTab('produtos')">üçî Produtos</button>
    <button class="tab" onclick="showTab('pedidos')">üì¶ Pedidos</button>
    <button class="tab" onclick="showTab('vendas')">üí∞ Vendas</button>
  </div>

  <!-- Dashboard Tab -->
  <div id="dashboard" class="tab-content active">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="num" id="statTotalProdutos">0</div>
        <div class="label">Total de Produtos</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statPedidosHoje">0</div>
        <div class="label">Pedidos Hoje</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statVendasHoje">R$ 0</div>
        <div class="label">Vendas Hoje</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statTotalPedidos">0</div>
        <div class="label">Total de Pedidos</div>
      </div>
    </div>

    <div class="panel">
      <h2>üìà Vendas por Categoria</h2>
      <div class="chart-container">
        <canvas id="categoryChart" width="400" height="200"></canvas>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h2>üö® Pedidos Recentes</h2>
        <div id="recentOrders" class="orders-list">
          <!-- Pedidos ser√£o carregados aqui -->
        </div>
      </div>

      <div class="panel">
        <h2>‚ö° A√ß√µes R√°pidas</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <button class="btn btn-primary" onclick="showTab('produtos')">
            ‚ûï Adicionar Produto
          </button>
          <button class="btn btn-success" onclick="exportarMenuJSON()">
            üì§ Exportar Card√°pio
          </button>
          <button class="btn btn-warning" onclick="sincronizarCardapio()">
            üîÑ Sincronizar
          </button>
          <button class="btn btn-ghost" onclick="carregarDados()">
            üìä Atualizar Dados
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Produtos Tab -->
  <div id="produtos" class="tab-content">
    <div class="panel">
      <h2>üçî Gerenciar Produtos</h2>
      
      <div style="display: flex; gap: 12px; margin-bottom: 20px;">
        <input type="text" id="searchInput" placeholder="Buscar produtos..." style="flex: 1;">
        <select id="filterCat">
          <option value="">Todas as categorias</option>
          <option value="Hamb√∫rgueres">Hamb√∫rgueres</option>
          <option value="Combos">Combos</option>
          <option value="Acompanhamentos">Acompanhamentos</option>
          <option value="Adicionais">Adicionais</option>
          <option value="Bebidas">Bebidas</option>
        </select>
        <button class="btn btn-primary" onclick="novoProduto()">
          ‚ûï Novo Produto
        </button>
      </div>

      <div class="table-container">
        <table id="produtosTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Pre√ßo</th>
              <th>Imagem</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="produtosTableBody">
            <!-- Produtos ser√£o carregados aqui -->
          </tbody>
        </table>
      </div>

      <div class="tools">
        <input type="file" id="importFile" accept=".json" style="display: none;">
        <button class="btn btn-ghost" onclick="document.getElementById('importFile').click()">
          üì• Importar JSON
        </button>
        <button class="btn btn-success" onclick="exportarMenuJSON()">
          üì§ Exportar JSON
        </button>
        <button class="btn btn-warning" onclick="sincronizarCardapio()">
          üîÑ Sincronizar Card√°pio
        </button>
        <button class="btn btn-ghost" onclick="fazerBackupLocal()">
          üíæ Backup Local
        </button>
        <button class="btn btn-ghost" onclick="restaurarBackupLocal()">
          üîÑ Restaurar Backup
        </button>
      </div>
    </div>

    <div class="panel">
      <h2 id="formTitle">‚ûï Adicionar Novo Produto</h2>
      <form id="prodForm">
        <input type="hidden" id="prodId">
        
        <div class="form-grid">
          <div class="form-group">
            <label for="prodName">Nome do Produto *</label>
            <input type="text" id="prodName" required>
          </div>
          
          <div class="form-group">
            <label for="prodPrice">Pre√ßo (R$) *</label>
            <input type="number" id="prodPrice" step="0.01" min="0" required>
          </div>
          
          <div class="form-group">
            <label for="prodCat">Categoria *</label>
            <select id="prodCat" required>
              <option value="">Selecione...</option>
              <option value="Hamb√∫rgueres">üçî Hamb√∫rgueres</option>
              <option value="Combos">ü•° Combos</option>
              <option value="Acompanhamentos">üçü Acompanhamentos</option>
              <option value="Adicionais">‚ûï Adicionais</option>
              <option value="Bebidas">ü•§ Bebidas</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="prodImg">URL da Imagem</label>
            <input type="text" id="prodImg" placeholder="ex: images/hamburguer.jpg">
          </div>
        </div>
        
        <div class="form-group">
          <label for="prodDesc">Descri√ß√£o</label>
          <textarea id="prodDesc" rows="3" placeholder="Descri√ß√£o do produto..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Preview da Imagem</label>
          <div class="img-preview" id="imgPreview">
            <div class="placeholder">Imagem ser√° exibida aqui</div>
          </div>
          <input type="file" id="prodImgFile" accept="image/*" style="display: none;">
          <button type="button" class="btn btn-ghost btn-sm" onclick="document.getElementById('prodImgFile').click()">
            üìÅ Escolher Arquivo
          </button>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            üíæ Salvar Produto
          </button>
          <button type="button" class="btn btn-ghost" onclick="limparForm()">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Pedidos Tab -->
  <div id="pedidos" class="tab-content">
    <div class="panel">
      <h2>üì¶ Pedidos Recebidos</h2>
      <div id="ordersList" class="orders-list">
        <!-- Pedidos ser√£o carregados aqui -->
      </div>
    </div>
  </div>

  <!-- Vendas Tab -->
  <div id="vendas" class="tab-content">
    <div class="panel">
      <h2>üí∞ Relat√≥rio de Vendas</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="num" id="vendasTotal">R$ 0</div>
          <div class="label">Total em Vendas</div>
        </div>
        <div class="stat-card">
          <div class="num" id="vendasMedia">R$ 0</div>
          <div class="label">Ticket M√©dio</div>
        </div>
        <div class="stat-card">
          <div class="num" id="vendasPedidos">0</div>
          <div class="label">Total de Pedidos</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="login-backdrop">
  <div class="login-box">
    <h3>üîê Acesso Restrito</h3>
    <div class="form-group">
      <label>Usu√°rio</label>
      <input type="text" id="loginUser" placeholder="admin">
    </div>
    <div class="form-group">
      <label>Senha</label>
      <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <div class="form-actions">
      <button class="btn btn-primary" onclick="fazerLogin()">Entrar</button>
      <button class="btn btn-ghost" onclick="fecharLogin()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Notification -->
<div id="notification" class="notification"></div>

<script>
// ==============================
// DASHBOARD COMPLETO E FUNCIONAL
// ==============================

const CREDENTIALS = { user: "admin", pass: "1234" };
let produtos = [];
let pedidos = [];
let usuarioLogado = false;

// ========== FUN√á√ïES PRINCIPAIS ==========

// Carregar dados iniciais
async function carregarDados() {
  await carregarProdutos();
  await carregarPedidos();
  await carregarEstatisticas();
}

// Carregar produtos do servidor
async function carregarProdutos() {
  try {
    showLoading(true);
    const response = await fetch('/api/menu');
    if (response.ok) {
      produtos = await response.json();
      renderizarProdutos();
      showNotification('Produtos carregados com sucesso!');
    } else {
      throw new Error('Erro ao carregar produtos');
    }
  } catch (error) {
    console.error('Erro ao carregar produtos:', error);
    showNotification('Erro ao carregar produtos', 'error');
  } finally {
    showLoading(false);
  }
}

// Carregar pedidos do servidor
async function carregarPedidos() {
  try {
    const response = await fetch('/api/orders');
    if (response.ok) {
      pedidos = await response.json();
      renderizarPedidos();
      renderizarPedidosRecentes();
    }
  } catch (error) {
    console.error('Erro ao carregar pedidos:', error);
  }
}

// Carregar estat√≠sticas
async function carregarEstatisticas() {
  try {
    const response = await fetch('/api/stats');
    if (response.ok) {
      const stats = await response.json();
      
      document.getElementById('statTotalProdutos').textContent = stats.totalProdutos;
      document.getElementById('statPedidosHoje').textContent = stats.pedidosHoje;
      document.getElementById('statVendasHoje').textContent = `R$ ${stats.vendasHoje.toFixed(2)}`;
      document.getElementById('statTotalPedidos').textContent = stats.totalPedidos;
      
      // Atualizar aba de vendas
      document.getElementById('vendasTotal').textContent = `R$ ${stats.vendasHoje.toFixed(2)}`;
      document.getElementById('vendasPedidos').textContent = stats.totalPedidos;
      
      const ticketMedio = stats.pedidosHoje > 0 ? stats.vendasHoje / stats.pedidosHoje : 0;
      document.getElementById('vendasMedia').textContent = `R$ ${ticketMedio.toFixed(2)}`;
    }
  } catch (error) {
    console.error('Erro ao carregar estat√≠sticas:', error);
  }
}

// ========== GERENCIAMENTO DE PRODUTOS ==========

function renderizarProdutos(lista = produtos) {
  const tbody = document.getElementById('produtosTableBody');
  tbody.innerHTML = '';

  if (lista.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">Nenhum produto cadastrado</td></tr>';
    return;
  }

  lista.forEach(produto => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${produto.id || produto._id}</td>
      <td><strong>${produto.name}</strong></td>
      <td>${produto.cat}</td>
      <td>R$ ${produto.price.toFixed(2)}</td>
      <td>${produto.imgUrl ? '‚úÖ' : '‚ùå'}</td>
      <td class="action-buttons">
        <button class="btn btn-ghost btn-sm" onclick="editarProduto('${produto.id || produto._id}')" title="Editar">
          ‚úèÔ∏è
        </button>
        <button class="btn btn-ghost btn-sm" onclick="excluirProduto('${produto.id || produto._id}')" title="Excluir">
          üóëÔ∏è
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function novoProduto() {
  document.getElementById('formTitle').textContent = '‚ûï Adicionar Novo Produto';
  document.getElementById('prodForm').reset();
  document.getElementById('prodId').value = '';
  document.getElementById('imgPreview').innerHTML = '<div class="placeholder">Imagem ser√° exibida aqui</div>';
  showTab('produtos');
}

function editarProduto(id) {
  const produto = produtos.find(p => (p.id === id) || (p._id === id));
  if (!produto) return;

  document.getElementById('formTitle').textContent = '‚úèÔ∏è Editar Produto';
  document.getElementById('prodId').value = produto.id || produto._id;
  document.getElementById('prodName').value = produto.name;
  document.getElementById('prodPrice').value = produto.price;
  document.getElementById('prodCat').value = produto.cat;
  document.getElementById('prodImg').value = produto.imgUrl || '';
  document.getElementById('prodDesc').value = produto.desc || '';
  
  // Preview da imagem
  if (produto.imgUrl) {
    document.getElementById('imgPreview').innerHTML = `<img src="${produto.imgUrl}" alt="${produto.name}">`;
  }
  
  showTab('produtos');
}

async function excluirProduto(id) {
  if (!confirm('Tem certeza que deseja excluir este produto?')) return;

  try {
    const response = await fetch(`/api/menu/item/${id}`, {
      method: 'DELETE'
    });

    if (response.ok) {
      showNotification('Produto exclu√≠do com sucesso!');
      await carregarProdutos();
    } else {
      throw new Error('Erro ao excluir produto');
    }
  } catch (error) {
    console.error('Erro ao excluir produto:', error);
    showNotification('Erro ao excluir produto', 'error');
  }
}

// Form submit handler
document.getElementById('prodForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  await salvarProduto();
});

async function salvarProduto() {
  const id = document.getElementById('prodId').value;
  const produto = {
    name: document.getElementById('prodName').value,
    price: parseFloat(document.getElementById('prodPrice').value),
    cat: document.getElementById('prodCat').value,
    imgUrl: document.getElementById('prodImg').value,
    desc: document.getElementById('prodDesc').value
  };

  try {
    let response;
    if (id) {
      // Editar produto existente
      response = await fetch(`/api/menu/item/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(produto)
      });
    } else {
      // Adicionar novo produto
      produto.id = Date.now(); // ID tempor√°rio
      response = await fetch('/api/menu/item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(produto)
      });
    }

    if (response.ok) {
      showNotification(id ? 'Produto atualizado com sucesso!' : 'Produto adicionado com sucesso!');
      await carregarProdutos();
      limparForm();
    } else {
      throw new Error('Erro ao salvar produto');
    }
  } catch (error) {
    console.error('Erro ao salvar produto:', error);
    showNotification('Erro ao salvar produto', 'error');
  }
}

function limparForm() {
  document.getElementById('prodForm').reset();
  document.getElementById('prodId').value = '';
  document.getElementById('imgPreview').innerHTML = '<div class="placeholder">Imagem ser√° exibida aqui</div>';
  document.getElementById('formTitle').textContent = '‚ûï Adicionar Novo Produto';
}

// ========== PEDIDOS ==========

function renderizarPedidos() {
  const container = document.getElementById('ordersList');
  container.innerHTML = '';

  if (pedidos.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted)">Nenhum pedido recebido</div>';
    return;
  }

  pedidos.forEach(pedido => {
    const div = document.createElement('div');
    div.className = 'order-item';
    div.innerHTML = `
      <div class="order-header">
        <div class="order-id">Pedido #${pedido.id || pedido._id}</div>
        <div class="order-date">${new Date(pedido.data).toLocaleString()}</div>
      </div>
      <div class="order-total">Total: R$ ${pedido.total.toFixed(2)}</div>
      <div style="margin-top: 8px; font-size: 14px;">
        <strong>Itens:</strong> ${pedido.itens.map(item => `${item.quantidade}x ${item.nome}`).join(', ')}
      </div>
      <div style="margin-top: 4px; font-size: 12px; color: var(--muted)">
        Cliente: ${pedido.cliente || 'N√£o informado'}
      </div>
    `;
    container.appendChild(div);
  });
}

function renderizarPedidosRecentes() {
  const container = document.getElementById('recentOrders');
  const recentes = pedidos.slice(0, 5); // √öltimos 5 pedidos
  
  container.innerHTML = '';

  if (recentes.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--muted)">Nenhum pedido recente</div>';
    return;
  }

  recentes.forEach(pedido => {
    const div = document.createElement('div');
    div.className = 'order-item';
    div.innerHTML = `
      <div class="order-header">
        <div class="order-id">Pedido #${pedido.id || pedido._id}</div>
        <div class="order-total">R$ ${pedido.total.toFixed(2)}</div>
      </div>
      <div style="font-size: 14px;">
        ${pedido.itens.length} itens ‚Ä¢ ${new Date(pedido.data).toLocaleTimeString()}
      </div>
    `;
    container.appendChild(div);
  });
}

// ========== SINCRONIZA√á√ÉO ==========

async function sincronizarCardapio() {
  try {
    showLoading(true);
    const response = await fetch('/api/menu', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(produtos)
    });

    if (response.ok) {
      showNotification('Card√°pio sincronizado com sucesso!');
      await carregarProdutos();
    } else {
      throw new Error('Erro ao sincronizar');
    }
  } catch (error) {
    console.error('Erro ao sincronizar:', error);
    showNotification('Erro ao sincronizar card√°pio', 'error');
  } finally {
    showLoading(false);
  }
}

// ========== EXPORT/IMPORT ==========

function exportarMenuJSON() {
  const dataStr = JSON.stringify(produtos, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  
  const link = document.createElement('a');
  link.href = URL.createObjectURL(dataBlob);
  link.download = 'menu-artesanal-blend.json';
  link.click();
  
  showNotification('Card√°pio exportado com sucesso!');
}

// Import via file input
document.getElementById('importFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedData = JSON.parse(e.target.result);
      produtos = importedData;
      renderizarProdutos();
      showNotification('Dados importados com sucesso!');
    } catch (error) {
      showNotification('Erro ao importar arquivo', 'error');
    }
  };
  reader.readAsText(file);
});

// ========== BACKUP LOCAL ==========

function fazerBackupLocal() {
  localStorage.setItem('artesanal_blend_backup', JSON.stringify(produtos));
  showNotification('Backup local salvo com sucesso!');
}

function restaurarBackupLocal() {
  const backup = localStorage.getItem('artesanal_blend_backup');
  if (backup) {
    produtos = JSON.parse(backup);
    renderizarProdutos();
    showNotification('Backup restaurado com sucesso!');
  } else {
    showNotification('Nenhum backup encontrado', 'error');
  }
}

// ========== INTERFACE ==========

function showTab(tabName) {
  // Esconder todas as tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Mostrar tab selecionada
  document.getElementById(tabName).classList.add('active');
  
  // Atualizar bot√µes
  document.querySelectorAll('.tab').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
}

function showNotification(message, type = 'success') {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.className = `notification ${type === 'error' ? 'error' : ''} show`;
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

function showLoading(show) {
  if (show) {
    document.body.classList.add('loading');
  } else {
    document.body.classList.remove('loading');
  }
}

// ========== LOGIN ==========

function fazerLogin() {
  const user = document.getElementById('loginUser').value;
  const pass = document.getElementById('loginPass').value;

  if (user === CREDENTIALS.user && pass === CREDENTIALS.pass) {
    usuarioLogado = true;
    document.getElementById('
