<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Artesanal Blend</title>
<style>
:root {
  --bg: #f9f9f9;
  --panel: #ffffff;
  --accent: #3b82f6;
  --accent-hover: #2563eb;
  --muted: #666;
  --text: #222;
  --border: #ddd;
  --success: #22c55e;
  --danger: #ef4444;
  --warning: #f59e0b;
}

/* ====== CSS resumido ====== */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
.wrap { max-width: 1400px; margin: 0 auto; padding: 20px; }
header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background:#fff; border-radius:12px; margin-bottom:24px; border:1px solid var(--border); box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.header-left { display:flex; align-items:center; gap:16px;}
header img { width:60px; height:60px; border-radius:10px; object-fit:cover;}
header h1 { font-size:24px; font-weight:700;}
.header-right { display:flex; align-items:center; gap:16px;}
.user-info { font-size:14px; color:var(--muted);}
.grid { display:grid; grid-template-columns:1fr 400px; gap:24px;}
@media(max-width:1200px){.grid{grid-template-columns:1fr;}}
.panel { background:var(--panel); padding:24px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08); border:1px solid var(--border); margin-bottom:20px;}
.panel h2 { font-size:20px; margin-bottom:20px; display:flex; align-items:center; gap:8px;}
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:16px; margin-bottom:20px;}
.stat-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; border-radius:10px; text-align:center;}
.stat-card .num { font-size:32px; font-weight:700; margin-bottom:8px;}
.stat-card .label { font-size:14px; opacity:0.9;}
.table-container { overflow-x:auto; border-radius:8px; border:1px solid var(--border);}
table { width:100%; border-collapse:collapse; background:var(--panel);}
th,td { padding:12px 16px; text-align:left; border-bottom:1px solid var(--border); font-size:14px;}
th { background:#f8fafc; font-weight:600;}
tr:hover { background:#f8fafc;}
.form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px;}
@media(max-width:768px){.form-grid{grid-template-columns:1fr;}}
.form-group { margin-bottom:16px;}
.form-group label { display:block; margin-bottom:6px; font-weight:500; font-size:14px;}
.form-group input, .form-group select, .form-group textarea { width:100%; padding:12px; border:1px solid var(--border); border-radius:8px; font-size:14px; background:var(--panel);}
.form-actions { display:flex; gap:12px; margin-top:24px; padding-top:20px; border-top:1px solid var(--border);}
.img-preview { width:100%; height:200px; background:#f8fafc; border:2px dashed var(--border); border-radius:8px; display:flex; align-items:center; justify-content:center; overflow:hidden; margin-bottom:16px;}
.img-preview img { width:100%; height:100%; object-fit:cover;}
.tabs { display:flex; gap:4px; margin-bottom:24px; background:#f8fafc; padding:4px; border-radius:8px;}
.tab { flex:1; padding:12px 16px; text-align:center; background:transparent; border:none; border-radius:6px; cursor:pointer; font-weight:500; transition:all 0.2s;}
.tab.active { background:white; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.tab-content { display:none;}
.tab-content.active { display:block;}
.status-badge { padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;}
.status-pending { background:#fef3c7; color:#92400e;}
.status-completed { background:#d1fae5; color:#065f46;}
.status-cancelled { background:#fee2e2; color:#991b1b;}
.action-buttons { display:flex; gap:8px;}
.btn { display:inline-flex; align-items:center; gap:6px; padding:12px 20px; border:none; border-radius:8px; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; text-decoration:none;}
.btn-primary { background:var(--accent); color:white;}
.btn-primary:hover { background:var(--accent-hover);}
.btn-success { background:var(--success); color:white;}
.btn-danger { background:var(--danger); color:white;}
.btn-warning { background:var(--warning); color:white;}
.btn-ghost { background:transparent; color:var(--text); border:1px solid var(--border);}
.btn-ghost:hover { background:#f8fafc;}
.btn-sm { padding:8px 12px; font-size:12px;}
.login-backdrop { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:1000;}
.login-box { background:white; padding:32px; border-radius:12px; width:400px; max-width:90vw; box-shadow:0 20px 40px rgba(0,0,0,0.1);}
.notification { position:fixed; top:20px; right:20px; padding:16px 20px; border-radius:8px; background:white; box-shadow:0 4px 12px rgba(0,0,0,0.15); border-left:4px solid var(--success); z-index:1001; transform:translateX(400px); transition:transform 0.3s;}
.notification.show { transform:translateX(0);}
.notification.error { border-left-color:var(--danger);}
.loading { opacity:0.6; pointer-events:none;}
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="header-left">
      <img src="logo.jpg" alt="Artesanal Blend">
      <h1>Dashboard Artesanal Blend</h1>
    </div>
    <div class="header-right">
      <div class="user-info">
        Usu√°rio: <strong id="currentUser">‚Äî</strong>
      </div>
      <button id="logoutBtn" class="btn btn-ghost" style="display:none">Sair</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
    <button class="tab" onclick="showTab('produtos')">üçî Produtos</button>
    <button class="tab" onclick="showTab('pedidos')">üì¶ Pedidos</button>
    <button class="tab" onclick="showTab('vendas')">üí∞ Vendas</button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="tab-content active">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="num" id="statTotalProdutos">0</div>
        <div class="label">Total de Produtos</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statPedidosHoje">0</div>
        <div class="label">Pedidos Hoje</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statVendasHoje">R$ 0</div>
        <div class="label">Vendas Hoje</div>
      </div>
      <div class="stat-card">
        <div class="num" id="statTotalPedidos">0</div>
        <div class="label">Total de Pedidos</div>
      </div>
    </div>

    <div class="panel">
      <h2>üìà Vendas por Categoria</h2>
      <div class="chart-container">
        <canvas id="categoryChart" width="400" height="200"></canvas>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h2>üö® Pedidos Recentes</h2>
        <div id="recentOrders" class="orders-list"></div>
      </div>
      <div class="panel">
        <h2>‚ö° A√ß√µes R√°pidas</h2>
        <div style="display:flex; flex-direction:column; gap:12px;">
          <button class="btn btn-primary" onclick="novoProduto()">‚ûï Adicionar Produto</button>
          <button class="btn btn-success" onclick="exportarMenuJSON()">üì§ Exportar Card√°pio</button>
          <button class="btn btn-warning" onclick="sincronizarCardapio()">üîÑ Sincronizar</button>
          <button class="btn btn-ghost" onclick="carregarDados()">üìä Atualizar Dados</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PRODUTOS -->
  <div id="produtos" class="tab-content">
    <div class="panel">
      <h2>üçî Gerenciar Produtos</h2>
      <div style="display:flex; gap:12px; margin-bottom:20px;">
        <input type="text" id="searchInput" placeholder="Buscar produtos..." style="flex:1;">
        <select id="filterCat">
          <option value="">Todas as categorias</option>
          <option value="Hamb√∫rgueres">Hamb√∫rgueres</option>
          <option value="Combos">Combos</option>
          <option value="Acompanhamentos">Acompanhamentos</option>
          <option value="Adicionais">Adicionais</option>
          <option value="Bebidas">Bebidas</option>
        </select>
        <button class="btn btn-primary" onclick="novoProduto()">‚ûï Novo Produto</button>
      </div>
      <div class="table-container">
        <table id="produtosTable">
          <thead>
            <tr><th>ID</th><th>Nome</th><th>Categoria</th><th>Pre√ßo</th><th>Imagem</th><th>A√ß√µes</th></tr>
          </thead>
          <tbody id="produtosTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="panel">
      <h2 id="formTitle">‚ûï Adicionar Novo Produto</h2>
      <form id="prodForm">
        <input type="hidden" id="prodId">
        <div class="form-grid">
          <div class="form-group">
            <label for="prodName">Nome do Produto *</label>
            <input type="text" id="prodName" required>
          </div>
          <div class="form-group">
            <label for="prodPrice">Pre√ßo (R$) *</label>
            <input type="number" id="prodPrice" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label for="prodCat">Categoria *</label>
            <select id="prodCat" required>
              <option value="">Selecione...</option>
              <option value="Hamb√∫rgueres">üçî Hamb√∫rgueres</option>
              <option value="Combos">ü•° Combos</option>
              <option value="Acompanhamentos">üçü Acompanhamentos</option>
              <option value="Adicionais">‚ûï Adicionais</option>
              <option value="Bebidas">ü•§ Bebidas</option>
            </select>
          </div>
          <div class="form-group">
            <label for="prodImg">URL da Imagem</label>
            <input type="text" id="prodImg" placeholder="ex: images/hamburguer.jpg">
          </div>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="prodDesc" rows="3" placeholder="Descri√ß√£o do produto..."></textarea>
        </div>
        <div class="form-group">
          <label>Preview da Imagem</label>
          <div class="img-preview" id="imgPreview"><div class="placeholder">Imagem ser√° exibida aqui</div></div>
          <input type="file" id="prodImgFile" accept="image/*" style="display:none;">
          <button type="button" class="btn btn-ghost btn-sm" onclick="document.getElementById('prodImgFile').click()">üìÅ Escolher Arquivo</button>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">üíæ Salvar Produto</button>
          <button type="button" class="btn btn-ghost" onclick="limparForm()">‚ùå Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- PEDIDOS -->
  <div id="pedidos" class="tab-content">
    <div class="panel">
      <h2>üì¶ Pedidos Recebidos</h2>
      <div id="ordersList" class="orders-list"></div>
    </div>
  </div>

  <!-- VENDAS -->
  <div id="vendas" class="tab-content">
    <div class="panel">
      <h2>üí∞ Relat√≥rio de Vendas</h2>
      <div class="stats-grid">
        <div class="stat-card"><div class="num" id="vendasTotal">R$ 0</div><div class="label">Total em Vendas</div></div>
        <div class="stat-card"><div class="num" id="vendasMedia">R$ 0</div><div class="label">Ticket M√©dio</div></div>
        <div class="stat-card"><div class="num" id="vendasPedidos">0</div><div class="label">Total de Pedidos</div></div>
      </div>
    </div>
  </div>
</div>

<!-- LOGIN -->
<div id="loginModal" class="login-backdrop">
  <div class="login-box">
    <h3>üîê Acesso Restrito</h3>
    <div class="form-group"><label>Usu√°rio</label><input type="text" id="loginUser" placeholder="admin"></div>
    <div class="form-group"><label>Senha</label><input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <div class="form-actions">
      <button class="btn btn-primary" onclick="fazerLogin()">Entrar</button>
      <button class="btn btn-ghost" onclick="fecharLogin()">Cancelar</button>
    </div>
  </div>
</div>

<!-- NOTIFICA√á√ÉO -->
<div id="notification" class="notification"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// =========================
// VARI√ÅVEIS
// =========================
let produtos = [];
let pedidos = [];
let usuarioLogado = false;

// =========================
// LOGIN
// =========================
const CREDENTIALS = { user:'admin', pass:'1234' };
function fazerLogin(){
  const u = document.getElementById('loginUser').value;
  const p = document.getElementById('loginPass').value;
  if(u===CREDENTIALS.user && p===CREDENTIALS.pass){
    usuarioLogado=true;
    document.getElementById('currentUser').textContent=u;
    document.getElementById('logoutBtn').style.display='inline-flex';
    document.getElementById('loginModal').style.display='none';
    carregarDados();
    showNotification('Login realizado com sucesso!');
  } else { showNotification('Usu√°rio ou senha incorretos','error'); }
}
document.getElementById('logoutBtn').addEventListener('click',()=>{
  usuarioLogado=false;
  document.getElementById('currentUser').textContent='‚Äî';
  document.getElementById('logoutBtn').style.display='none';
  document.getElementById('loginModal').style.display='flex';
});

// =========================
// TABS
// =========================
function showTab(tabId){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
  document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// =========================
// CARREGAR DADOS
// =========================
async function carregarDados(){
  await carregarProdutos();
  await carregarPedidos();
  await carregarEstatisticas();
}
async function carregarProdutos(){
  try{
    const res = await fetch('/api/menu');
    produtos = res.ok ? await res.json() : [];
    renderizarProdutos();
  }catch(e){console.error(e);}
}
async function carregarPedidos(){
  try{
    const res = await fetch('/api/pedidos');
    const data = res.ok? await res.json(): {pedidos:[]};
    pedidos = data.pedidos || [];
    renderizarPedidos();
    renderizarPedidosRecentes();
  }catch(e){console.error(e);}
}
async function carregarEstatisticas(){
  try{
    const res = await fetch('/api/estatisticas');
    const stats = res.ok? await res.json(): {};
    document.getElementById('statTotalProdutos').textContent=stats.totalProdutos||0;
    document.getElementById('statPedidosHoje').textContent=stats.pedidosHoje||0;
    document.getElementById('statVendasHoje').textContent=`R$ ${stats.vendasHoje?.toFixed(2)||'0.00'}`;
    document.getElementById('statTotalPedidos').textContent=stats.totalPedidos||0;
    document.getElementById('vendasTotal').textContent=`R$ ${stats.vendasHoje?.toFixed(2)||'0.00'}`;
    document.getElementById('vendasPedidos').textContent=stats.totalPedidos||0;
    const ticket = stats.pedidosHoje>0 ? stats.vendasHoje/stats.pedidosHoje :0;
    document.getElementById('vendasMedia').textContent=`R$ ${ticket.toFixed(2)}`;
  }catch(e){console.error(e);}
}

// =========================
// RENDERIZAR PRODUTOS
// =========================
function renderizarProdutos(){
  const tbody=document.getElementById('produtosTableBody');
  tbody.innerHTML='';
  produtos.forEach(p=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>R$ ${p.price.toFixed(2)}</td>
      <td><img src="${p.image||''}" width="50"></td>
      <td class="action-buttons">
        <button class="btn btn-sm btn-primary" onclick="editarProduto(${p.id})">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-danger" onclick="excluirProduto(${p.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// =========================
// PRODUTO CRUD
// =========================
function novoProduto(){ limparForm(); showTab('produtos'); }
function limparForm(){
  document.getElementById('formTitle').textContent='‚ûï Adicionar Novo Produto';
  document.getElementById('prodForm').reset();
  document.getElementById('prodId').value='';
  document.getElementById('imgPreview').innerHTML='<div class="placeholder">Imagem ser√° exibida aqui</div>';
}
function editarProduto(id){
  const p=produtos.find(x=>x.id===id);
  if(!p) return;
  document.getElementById('formTitle').textContent='‚úèÔ∏è Editar Produto';
  document.getElementById('prodId').value=p.id;
  document.getElementById('prodName').value=p.name;
  document.getElementById('prodPrice').value=p.price;
  document.getElementById('prodCat').value=p.category;
  document.getElementById('prodDesc').value=p.description||'';
  document.getElementById('prodImg').value=p.image||'';
  if(p.image) document.getElementById('imgPreview').innerHTML=`<img src="${p.image}">`;
}
function excluirProduto(id){
  if(!confirm('Deseja realmente excluir este produto?')) return;
  produtos = produtos.filter(p=>p.id!==id);
  renderizarProdutos();
  showNotification('Produto exclu√≠do!');
}
document.getElementById('prodForm').addEventListener('submit',function(e){
  e.preventDefault();
  const id=document.getElementById('prodId').value;
  const novo={
    id: id? parseInt(id) : Date.now(),
    name: document.getElementById('prodName').value,
    price: parseFloat(document.getElementById('prodPrice').value),
    category: document.getElementById('prodCat').value,
    description: document.getElementById('prodDesc').value,
    image: document.getElementById('prodImg').value
  };
  if(id){
    const idx = produtos.findIndex(p=>p.id===parseInt(id));
    produtos[idx]=novo;
    showNotification('Produto atualizado!');
  } else {
    produtos.push(novo);
    showNotification('Produto adicionado!');
  }
  renderizarProdutos();
  limparForm();
});

// =========================
// PREVIEW IMAGEM
// =========================
document.getElementById('prodImgFile').addEventListener('change',function(){
  const file = this.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => document.getElementById('imgPreview').innerHTML=`<img src="${e.target.result}">`;
    reader.readAsDataURL(file);
  }
});

// =========================
// PEDIDOS
// =========================
function renderizarPedidos(){
  const div=document.getElementById('ordersList');
  div.innerHTML='';
  pedidos.forEach(p=>{
    const d=document.createElement('div');
    d.className='panel';
    d.innerHTML=`
      <strong>Pedido #${p.id}</strong> - ${p.customer||'Cliente'}<br>
      Status: <span class="status-badge status-${p.status}">${p.status}</span><br>
      Total: R$ ${p.total.toFixed(2)}
    `;
    div.appendChild(d);
  });
}
function renderizarPedidosRecentes(){
  const div=document.getElementById('recentOrders');
  div.innerHTML='';
  pedidos.slice(-5).reverse().forEach(p=>{
    const d=document.createElement('div');
    d.className='panel';
    d.innerHTML=`#${p.id} - ${p.customer||'Cliente'} - R$ ${p.total.toFixed(2)} - <span class="status-badge status-${p.status}">${p.status}</span>`;
    div.appendChild(d);
  });
}

// =========================
// NOTIFICA√á√ÉO
// =========================
function showNotification(msg,type='success'){
  const n=document.getElementById('notification');
  n.textContent=msg;
  n.className='notification show'+(type==='error'?' error':'');
  setTimeout(()=>{ n.className='notification'; },3000);
}

// =========================
// EXPORT / IMPORT JSON
// =========================
function exportarMenuJSON(){
  const dataStr = JSON.stringify(produtos,null,2);
  const blob = new Blob([dataStr],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='cardapio.json';
  a.click();
  URL.revokeObjectURL(url);
  showNotification('Card√°pio exportado!');
}
function sincronizarCardapio(){
  // Exemplo: pode enviar para backend
  showNotification('Sincroniza√ß√£o conclu√≠da!');
}

// =========================
// INICIALIZA√á√ÉO
// =========================
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('loginModal').style.display='flex';
});

</script>

</body>
</html>
