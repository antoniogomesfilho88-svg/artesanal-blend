<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Artesanal Blend (Modo Claro)</title>
<style>
:root {
  --bg:#f9f9f9;
  --panel:#e3e3e3;
  --accent:#3b82f6;
  --muted:#666;
  --text:#222;
  --border:#ccc;
  --success:#22c55e;
}
html,body {
  margin:0; padding:0; font-family:Inter, system-ui, Arial, sans-serif;
  background:var(--bg); color:var(--text);
}
.wrap { max-width:1200px; margin:auto; padding:20px; }
header {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:16px; background:#fff; border:1px solid var(--border); border-radius:8px; padding:10px 16px;
}
header h1 { font-size:22px; margin:0; color:var(--text); }
header img { width:64px; border-radius:8px; }
button {
  cursor:pointer; border:none; border-radius:8px; padding:8px 12px;
  background:var(--accent); color:#fff; font-weight:500; transition:0.2s;
}
button:hover { opacity:0.9; }
button.ghost { background:#fff; color:var(--text); border:1px solid var(--border); }
.grid { display:grid; grid-template-columns: 1fr 380px; gap:16px; }
@media(max-width:900px){ .grid{ grid-template-columns:1fr; } }
.panel {
  background:var(--panel); padding:14px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.panel h2 { margin-top:0; color:var(--text); }
table { width:100%; border-collapse:collapse; }
th,td { padding:8px; border-bottom:1px solid var(--border); text-align:left; font-size:14px; }
th { color:var(--muted); }
input[type=text], input[type=number], select, textarea {
  width:100%; padding:8px; border:1px solid var(--border); border-radius:6px; background:#fff; color:var(--text);
}
textarea { min-height:70px; resize:vertical; }
label { font-size:13px; color:var(--muted); display:block; margin-bottom:4px; }
.form-actions { display:flex; gap:8px; margin-top:8px; }
.img-preview {
  width:100%; height:150px; background:#fff; border:1px solid var(--border);
  border-radius:8px; display:flex; align-items:center; justify-content:center; overflow:hidden; color:var(--muted);
}
.img-preview img { width:100%; height:100%; object-fit:cover; }
.tools { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.hint { font-size:12px; color:var(--muted); margin-top:4px; }
.stat { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.stat .num { font-size:18px; font-weight:600; color:var(--accent); }
.chart-wrap { background:#fff; border-radius:8px; padding:8px; margin-top:8px; border:1px solid var(--border); }
.login-backdrop {
  position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:99;
}
.login-box {
  background:#fff; padding:20px; border-radius:8px; width:300px; box-shadow:0 2px 8px rgba(0,0,0,0.3);
}
.login-box h3 { margin-top:0; color:var(--text); }
.muted { color:var(--muted); font-size:13px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div style="display:flex;align-items:center;gap:12px;">
      <img src="logo.jpg" alt="logo">
      <h1>Dashboard ‚Äî Artesanal Blend</h1>
    </div>
    <div>
      <span class="muted">Usu√°rio: <b id="currentUser">‚Äî</b></span>
      <button id="logoutBtn" class="ghost" style="display:none">Logout</button>
    </div>
  </header>

  <div class="grid">
    <div>
      <div class="panel">
        <h2>Produtos</h2>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
          <input id="searchInput" type="text" placeholder="Buscar produto..." style="flex:1;">
          <select id="filterCat">
            <option value="">Todas as categorias</option>
          </select>
          <button id="newBtn">Novo</button>
        </div>

        <div style="overflow:auto;max-height:350px;">
          <table id="prodTable">
            <thead><tr><th>ID</th><th>Nome</th><th>Categoria</th><th>Pre√ßo</th><th>Imagem</th><th>A√ß√µes</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="tools">
          <input id="importFile" type="file" accept=".json" />
          <button id="importBtn" class="ghost">Importar</button>
          <button id="exportBtn">Exportar</button>
          <button id="saveLocalBtn" class="ghost">Salvar Local</button>
          <button id="restoreLocalBtn" class="ghost">Restaurar</button>
        </div>
      </div>

      <div class="panel" style="margin-top:12px;">
        <h2 id="formTitle">Adicionar / Editar Produto</h2>
        <form id="prodForm">
          <input id="prodId" type="hidden" />
          <label>Nome</label><input id="prodName" type="text" required />
          <label>Pre√ßo (R$)</label><input id="prodPrice" type="number" step="0.01" required />
          <label>Categoria</label>
          <select id="prodCat">
            <option>Hamb√∫rgueres</option><option>Combos</option>
            <option>Acompanhamentos</option><option>Adicionais</option><option>Bebidas</option>
          </select>
          <label>Imagem (URL ou caminho)</label><input id="prodImg" type="text" />
          <label>Arquivo de imagem</label><input id="prodImgFile" type="file" accept="image/*" />
          <label>Descri√ß√£o</label><textarea id="prodDesc"></textarea>
          <div class="img-preview" id="imgPreview">Preview</div>
          <div class="form-actions">
            <button type="submit">Salvar</button>
            <button type="button" id="cancelBtn" class="ghost">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <div>
      <div class="panel">
        <h2>Estat√≠sticas</h2>
        <div class="stat"><div class="num" id="statCount">0</div><div>Total de produtos</div></div>
        <div class="stat"><div class="num" id="statAvg">R$ 0,00</div><div>Pre√ßo m√©dio</div></div>
        <div class="chart-wrap"><canvas id="catChart" width="320" height="200"></canvas></div>
      </div>

      <div class="panel" style="margin-top:12px;">
        <h2>Login</h2>
        <button id="openLoginBtn" class="ghost">üîê Fazer login</button>
      </div>
    </div>
  </div>
</div>

<!-- login modal -->
<div id="loginModal" class="login-backdrop" style="display:none">
  <div class="login-box">
    <h3>Entrar</h3>
    <label>Usu√°rio</label><input id="loginUser" type="text">
    <label>Senha</label><input id="loginPass" type="password">
    <div style="display:flex;gap:8px;margin-top:10px;">
      <button id="doLoginBtn">Entrar</button>
      <button id="closeLoginBtn" class="ghost">Cancelar</button>
    </div>
  </div>
</div>

<script>
const CREDENTIALS={user:"admin",pass:"1234"};
let produtos=[];
const tBody=document.querySelector("#prodTable tbody");
const form=document.getElementById("prodForm");
const imgInput=document.getElementById("prodImg");
const imgFile=document.getElementById("prodImgFile");
const imgPreview=document.getElementById("imgPreview");
const currentUser=document.getElementById("currentUser");
const loginModal=document.getElementById("loginModal");
let logged=false;
async function loadMenu(){
 try{
  const r=await fetch("menu.json",{cache:"no-store"});
  produtos=await r.json(); render();
 }catch(e){produtos=[];render();}
}
function render(list=produtos){
 tBody.innerHTML="";
 list.forEach(p=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td>${p.id}</td><td>${p.name}</td><td>${p.cat}</td><td>R$ ${p.price.toFixed(2)}</td><td>${p.imgUrl||""}</td>
  <td><button onclick="editP(${p.id})" class="ghost">‚úèÔ∏è</button>
  <button onclick="delP(${p.id})" class="ghost">üóëÔ∏è</button></td>`;
  tBody.appendChild(tr);
 });
 updateStats();
}
function uid(){return produtos.length?Math.max(...produtos.map(p=>p.id))+1:1;}
form.onsubmit=e=>{
 e.preventDefault();
 const id=form.querySelector("#prodId").value;
 const n={id:id?Number(id):uid(),name:prodName.value,price:parseFloat(prodPrice.value)||0,cat:prodCat.value,desc:prodDesc.value,imgUrl:imgInput.value};
 if(id){const i=produtos.findIndex(p=>p.id==id);produtos[i]=n;} else produtos.push(n);
 form.reset();imgPreview.innerHTML="Preview";render();
}
function editP(id){const p=produtos.find(x=>x.id==id);if(!p)return;prodId.value=p.id;prodName.value=p.name;prodPrice.value=p.price;prodCat.value=p.cat;prodImg.value=p.imgUrl;prodDesc.value=p.desc;previewImg(p.imgUrl);}
function delP(id){if(confirm("Excluir produto?")){produtos=produtos.filter(p=>p.id!=id);render();}}
function updateStats(){statCount.innerText=produtos.length;const avg=produtos.length?produtos.reduce((s,p)=>s+p.price,0)/produtos.length:0;statAvg.innerText=`R$ ${avg.toFixed(2)}`;}
function previewImg(src){if(!src){imgPreview.innerText="Preview";return;}imgPreview.innerHTML=`<img src="${src}" alt="">`;}
imgInput.oninput=()=>previewImg(imgInput.value);
imgFile.onchange=e=>{const f=e.target.files[0];if(f){imgInput.value="imagens/"+f.name;const r=new FileReader();r.onload=x=>imgPreview.innerHTML=`<img src="${x.target.result}">`;r.readAsDataURL(f);alert("Copie o arquivo para a pasta imagens/");}};
document.getElementById("exportBtn").onclick=()=>{const blob=new Blob([JSON.stringify(produtos,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="menu.json";a.click();};
document.getElementById("importBtn").onclick=()=>document.getElementById("importFile").click();
document.getElementById("importFile").onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=x=>{produtos=JSON.parse(x.target.result);render();};r.readAsText(f);};
document.getElementById("saveLocalBtn").onclick=()=>{localStorage.setItem("menu_backup",JSON.stringify(produtos));alert("Salvo localmente");};
document.getElementById("restoreLocalBtn").onclick=()=>{const d=localStorage.getItem("menu_backup");if(d){produtos=JSON.parse(d);render();}};
openLoginBtn.onclick=()=>loginModal.style.display="flex";
closeLoginBtn.onclick=()=>loginModal.style.display="none";
doLoginBtn.onclick=()=>{if(loginUser.value==CREDENTIALS.user&&loginPass.value==CREDENTIALS.pass){logged=true;currentUser.innerText=loginUser.value;loginModal.style.display="none";logoutBtn.style.display="inline-block";alert("Login efetuado!");}else alert("Usu√°rio/senha incorretos");};
logoutBtn.onclick=()=>{logged=false;currentUser.innerText="‚Äî";logoutBtn.style.display="none";};
function drawChart(){const ctx=catChart.getContext("2d");ctx.clearRect(0,0,320,200);const cts={};produtos.forEach(p=>cts[p.cat]=(cts[p.cat]||0)+1);const keys=Object.keys(cts);if(keys.length==0){ctx.fillText("Sem dados",10,20);return;}const vals=Object.values(cts);const w=320,h=200,pad=10;const bw=(w-pad*2)/vals.length*0.6;const max=Math.max(...vals);keys.forEach((k,i)=>{const x=pad+i*((w-pad*2)/vals.length);const bh=(vals[i]/max)*(h-50);ctx.fillStyle=varAccent;ctx.fillRect(x+10,h-bh-30,bw,bh);ctx.fillStyle="#000";ctx.fillText(vals[i],x+15,h-bh-35);ctx.fillText(k,x+10,h-10);});}
loadMenu();
</script>
</body>
</html>
